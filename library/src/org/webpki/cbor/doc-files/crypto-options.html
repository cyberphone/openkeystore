<body>
<h2>Tagged and Custom Container Data</h2>
The CBOR library contains support for wrapping CSF and
CEF containers in a {@link CBORTag} as well as
including a custom data element.
<p>
In both cases the added information becomes a part of the
authenticated (signed) data.
</p> 
<h3 style='padding:1em 0 0 0'>Creating Tagged Containers</h3>
Creating a tagged CSF or CEF container is performed by calling
{@link CBORSigner#setIntercepter(CBORCryptoUtils.Intercepter)} and
{@link CBOREncrypter#setIntercepter(CBORCryptoUtils.Intercepter)} respectively,
where {@link CBORCryptoUtils.Intercepter#wrap(CBORMap)} is supposed
to do the actual wrapping.
<h3 style='padding:1em 0 0 0'>Decoding Tagged Containers</h3>
Decoding the tag of a tagged CSF or CEF container is performed by calling
{@link CBORValidator#setTagPolicy(CBORCryptoUtils.POLICY,CBORCryptoUtils.Collector)} and
{@link CBORDecrypter#setTagPolicy(CBORCryptoUtils.POLICY,CBORCryptoUtils.Collector)} respectively,
where {@link CBORCryptoUtils.Collector#foundData(CBORObject)} returns
the actual tag object or <code>null</code> if the container is not tagged.</p>
<code>&nbsp;&nbsp;&nbsp;&nbsp;nnn(</code><i>CBOR&nbsp;map</i><code>)</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;{@value CBORTag#RESERVED_TAG_COTE}([</code><i>CBOR&nbsp;text&nbsp;string</i><code>,
</code><i>CBOR&nbsp;map</i><code>])</code>
<p>
The purpose of the second construct is to provide a
generic way of adding an object type identifier in the
form of a URL to CBOR <code>map</code> objects.
The CBOR tag (<code>nnn</code>) would in this case be <i>constant</i>. 
Example:
</p>
<pre>
    211(["https://example.com/myobject", {
      "amount": "145.00",
      "currency": "USD"
    }])</pre><p>
Both wrapping methods are intrinsically
supported by {@link CBORValidator} and
{@link CBORDecrypter}
for signatures and encryption respectively.
</p>
CSF permits signing <code>map</code> objects that are enclosed by a CBOR tag.
Such tags are included in the data to be signed.
<p>
See {@link CBORCryptoUtils#unwrapContainerMap(CBORObject, POLICY tagPolicy)} for a detailed
description.
</p> 
<h3 style='padding:1em 0 0 0'>Signature Algorithms</h3>
<p id='csf-algorithms'>
Currently supported signature algorithms:
</p>
<table class='webpkitable'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th></tr>
<tr style='text-align:center'><td><code>HS256</code></td><td>5</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>HS384</code></td><td>6</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>HS512</code></td><td>7</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>Ed25519</code></td><td>-8</td><td>FIDO, PKIX [1]</td></tr>
<tr style='text-align:center'><td><code>Ed448</code></td><td>-9</td><td>PKIX [2]</td></tr>
<tr style='text-align:center'><td><code>ES256</code></td><td>-7</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>ES384</code></td><td>-35</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>ES512</code></td><td>-36</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS256</code></td><td>-37</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS384</code></td><td>-38</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>PS512</code></td><td>-39</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS256</code></td><td>-257</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS384</code></td><td>-258</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>RS512</code></td><td>-259</td><td>COSE, JOSE</td></tr>
</table>
<p>[1] Unfortunately, different standards groups did not in due time realize that
existing cryptographic APIs only rarely accept &quot;EdDSA&quot; as a valid signature algorithm.
In current FIDO alliance specifications the COSE <code>EdDSA</code> algorithm identifier has
therefore been redefined to rather mean EdDSA with an Ed25519 key which is also what CSF follows.
PKIX' RFC&nbsp;8410 makes the same distinction.</p>
<p>[2] CSF extends the scheme used for <code>Ed25519</code> to <code>Ed448</code> as well.</p>
<h3 style='padding:1em 0 0 0'>Test Vectors</h3>
An extensive set of test vectors is currently available at: 
<a href='https://github.com/cyberphone/openkeystore/tree/master/testdata/cbor-encryption'>
https://github.com/cyberphone/openkeystore/tree/master/testdata/cbor-signatures
</a>.
<p>
Use {@link org.webpki.tools.CBORPrinter} to list contents in a human.friendly way.
</p>
</body>

