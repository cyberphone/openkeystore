<body>
<h1>Non-Finite Numbers</h1>
Unlike JSON&nbsp;[<a href='https://www.rfc-editor.org/rfc/rfc8259.html' class='webpkilink'>RFC&nbsp;8259</a>],
CBOR supports the non-finite floating-point constructs defined by IEEE-754, known as
<code>NaN</code> (not a number) and <code>Infinity</code>.
This implementation provides multiple levels of support, intended to
accommodate different needs.
This is accomplished without specific decoder or encoder options;
it is entirely based on API method selections.
The levels are represented by the following table:
<div class='webpkifloat' style='margin-left:2em'><table class='webpkitable' style='margin-bottom:0;min-width:30em'>
<tr><th>Designation</th><th>Comment</th></tr>
<tr><td style='text-align:center'><code>STANDARD</code></td><td>Only "regular" floating-point numbers are accepted;
an encountered non-finite number will throw a {@link CBORException}.
</td></tr>
<tr><td style='text-align:center'><code>EXTENDED</code></td><td>All but non-trivial non-finite numbers are accepted.
</td></tr>
<tr><td style='text-align:center'><code>COMPLETE</code></td><td>All floating-point numbers are accepted.
</td></tr>
</table></div>
<h5 style='margin:1.3em 0 1em 0'>Encoding</h5>
<div class='webpkifloat'>
<table style='margin-left:2em;font-family: monospace;white-space:nowrap;border-spacing:0'>
<tr><td colspan='2'>STANDARD</td></tr>
<tr><td style='padding-left:1.5em'>new&nbsp;{@link CBORFloat#CBORFloat(double) CBORFloat(<i>argument</i>)}</td><td>// "Regular" number</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>EXTENDED</td></tr>
<tr><td style='padding-left:1.5em'>{@link CBORFloat#createExtendedFloat(double) CBORFloat.createExtendedFloat(<i>argument</i>)}</td><td>// "Regular" number, NaN, or Infinity</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>COMPLETE</td></tr>
<tr><td style='padding-left:1.5em'>// Select suitable method:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td></td></tr>
<tr><td style='padding-left:1.5em'>new&nbsp;{@link CBORFloat#CBORFloat(double) CBORFloat(<i>argument</i>)}</td><td>// "Regular" number</td></tr>
<tr><td style='padding-left:1.5em'>new&nbsp;{@link CBORNonFinite#CBORNonFinite(long) CBORNonFinite(<i>argument</i>)}</td><td>// Arbitrary non-finite number</td></tr>
<tr><td style='padding-left:1.5em'>{@link CBORNonFinite#createPayloadObject(long) CBORNonFinite.createPayloadObject(<i>argument</i>)}</td><td>// Application-specific data</td></tr>
</table>
</div>
<h5 style='margin:1.3em 0 1em 0'>Decoding</h5>
<div class='webpkifloat'>
<table style='margin-left:2em;font-family: monospace;white-space:nowrap;border-spacing:0'>
<tr><td colspan='2'>STANDARD</td></tr>
<tr><td style='padding-left:1.5em'>cborObject.{@link CBORObject#getFloat64() getFloat64()}</td><td>// "Regular" number</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>EXTENDED</td></tr>
<tr><td style='padding-left:1.5em'>cborObject.{@link CBORObject#getExtendedFloat64() getExtendedFloat64()}</td><td>// "Regular" number, NaN, or Infinity</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>COMPLETE</td></tr>
<tr><td style='padding-left:1.5em'>// Check what the decoder returned:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td></td></tr>
<tr><td colspan='2' style='padding-left:1.5em'>if (cborObject instanceof {@link CBORNonFinite} nf) {</td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;// Non-finite number to process</td><td></td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;// Select suitable method:</td><td></td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;nf.{@link CBORNonFinite#getNonFinite() getNonFinite()}</td><td>// Arbitrary non-finite number</td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;nf.{@link CBORNonFinite#getPayloadData() getPayloadData()}</td><td>// Application-specific data</td></tr>
<tr><td style='padding-left:1.5em'>} else {</td><td></td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;// "Regular" number to process</td><td></td></tr>
<tr><td style='padding-left:1.5em'>&nbsp;&nbsp;cborObject.{@link CBORObject#getFloat64() getFloat64()}</td><td>// "Regular" number</td></tr>
<tr><td style='padding-left:1.5em'>}</td><td></td></tr>
</table>
</div>
<h3 id='payload-option' style='padding-top:0.5em'>Payload Option</h3>
<div>
Traditionally, the non-finite number space is used for propagating
math-related problems such as division by zero.
</div>
<div style='margin-top:0.5em'>
However, in some cases there may be a desire providing more application specific data,
like debug information related to faulty sensors.
The {@link CBORNonFinite#createPayloadObject(long)} and {@link CBORNonFinite#getPayloadData()}
methods were designed for this particular purpose.
To obviate the need defining another CBOR type, these methods
are "piggybacking" on the existing non-finite number space.
The following table represents these methods from a <i>developer</i> perspective:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Payload</th></tr>
<tr><td><code>d51-d0</code> in <i>big-endian</i> order</td></tr>
</table></div>
<div style='margin-top:0.5em'>
The payload bits are conceptually put into an <code>IEEE-754</code>
<code>64</code>-bit object having the following layout:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Sign</th><th>Exponent</th><th>Significand</th></tr>
<tr style='text-align:center'><td>0</td><td>11111111111</td><td style='white-space:nowrap'><code>d0-d51</code> in <i>little-endian</i> order</td></tr>
</table></div>
<div>
For setting the sign bit, see {@link CBORNonFinite#setSign(boolean)}.
</div>
<div style='margin-top:0.7em'>
The reason for <i>reversing</i> the payload bits is to ensure that a specific bit will remain
in a fix position (maintain the same value), independent of the size of the
<code>IEEE-754</code> variant used for encoding.
</div>
<div style='margin-top:0.7em'>
Note that the encoder will (due to CBOR deterministic encoding rules), select
the shortest serialization required to properly represent the payload.
The following table shows a few examples:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Payload (hex)</th><th>CBOR Encoding</th><th>Diagnostic Notation</th></tr>
<tr><td style='text-align:right'><code>0</code></td><td style='text-align:right'><code>f97c00</code></td><td><code>Infinity</code></td></tr>
<tr><td style='text-align:right'><code>1</code></td><td style='text-align:right'><code>f97e00</code></td><td><code>NaN</code></td></tr>
<tr><td style='text-align:right'><code>2</code></td><td style='text-align:right'><code>f97d00</code></td><td><code>float'7d00'</code></td></tr>
<tr><td style='text-align:right'><code>3ff</code></td><td style='text-align:right'><code>f97fff</code></td><td><code>float'7fff'</code></td></tr>
<tr><td style='text-align:right'><code>400</code></td><td style='text-align:right'><code>fa7f801000</code></td><td><code>float'7f801000'</code></td></tr>
<tr><td style='text-align:right'><code>7fffff</code></td><td style='text-align:right'><code>fa7fffffff</code></td><td><code>float'7fffffff'</code></td></tr>
<tr><td style='text-align:right'><code>800000</code></td><td style='text-align:right'><code>fb7ff0000010000000</code></td><td><code>float'7ff0000010000000'</code></td></tr>
<tr><td style='text-align:right'><code>fffffffffffff</code></td><td style='text-align:right'><code>fb7fffffffffffffff</code></td><td><code>float'7fffffffffffffff'</code></td></tr>
</table></div>
</body>